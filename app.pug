doctype html

html#hELLO(
  x-data='app'
  lang='ko'
  class='scroll-smooth')
  head
    meta(charset='utf-8')
    meta(name='viewport' content='width=device-width')

    title [##_page_title_##] â€” [##_title_##]

    link(rel='alternate' type='application/rss+xml' title='[##_title_##]' href='[##_rss_url_##]')

    link(rel='preconnect' href='//fonts.googleapis.com')
    link(rel='preconnect' href='//fonts.gstatic.com' crossorigin)

    link(rel='stylesheet' :href='"//cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css"')
    link(rel='stylesheet' :href='"//fonts.googleapis.com/css2?family=Source+Code+Pro:ital@0;1&display=swap"')
    link(rel='stylesheet' :href='"//cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"')
    link(rel='stylesheet' :href='`//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/${dark ? skinOptions.hljsDark : skinOptions.hljs}.min.css`')
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css' integrity='sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV' crossorigin='anonymous')

    script(src='./images/bootstrap.js')

    style(fixed).
      :root {
        --h-idx: 1100px; /* index */
        --h-pem: [##_var_width_##]px; /* permalink */
        --h-s: 256px; /* sidebar */
        --h-c: calc(100% - var(--h-s)); /* content */
        --h-h: 256px; /* header */
      }

    style
      include:postcss @/css/app.css
      include:postcss @/css/shortcutLayer.css

    script(fixed).
      /**
       * Set skin options
       *
       * @see https://tistory.github.io/document-tistory-skin/common/variable.html
       * @see docs/index.xml
       */
      window.skinOptions = {
        sidebar: '[##_var_sidebar_##]',
        foldableCategory: '[##_var_foldable-category_##]',
        width: '[##_var_width_##]',
        toc: '[##_var_toc_##]',
        scrollspy: '[##_var_scrollspy_##]',
        hljs: '[##_var_hljs_##]',
        hljsDark: '[##_var_hljs-dark_##]',
        headerStyle: '[##_var_header-style_##]'
      }

  body(
    id='[##_body_id_##]'
    class='overflow-x-hidden bg-h-100 dark:bg-h-800')
    block TIDORY

    script.
      document.addEventListener('alpine:init', () => Alpine.data('app', () => ({
        /**
         * @type {boolean}
         */
        dark: darkMode.on,

        /**
         * @type {boolean}
         */
        loading: true,

        /**
         * Init
         */
        init () {
          this.loaded()
        },

        /**
         * Loaded
         */
        loaded () {
          setTimeout(() => this.loading = false, 100)
        }
      })))

    script(defer src='https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js' integrity='sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8' crossorigin='anonymous')
    script(defer src='https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js' integrity='sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05' crossorigin='anonymous')
    script.
      document.addEventListener('DOMContentLoaded', () => {
        const articleBody = document.querySelector('.contents_style');
        if (articleBody) {
          let bodyHTML = articleBody.innerHTML;
          const displayMathRegex = /\$\$([\s\S]*?)\$\$/g;

          bodyHTML = bodyHTML.replace(displayMathRegex, (match, latexSource) => {
            // 1. Decode HTML entities first (e.g., &lt;br&gt; -> <br>)
            const decoder = document.createElement('textarea');
            decoder.innerHTML = latexSource;
            let cleanedLatex = decoder.value;

            // 2. Replace <br> tags with the LaTeX newline command
            cleanedLatex = cleanedLatex.replace(/<br\s*\/?>/gi, ' \\ ');

            try {
              return katex.renderToString(cleanedLatex, {
                displayMode: true,
                throwOnError: false
              });
            } catch (e) {
              console.error('KaTeX rendering failed for block:', cleanedLatex, e);
              return match;
            }
          });

          articleBody.innerHTML = bodyHTML;
        }

        // Render all math, including inline math, for the whole document.
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\[', right: '\\]', display: true},
            {left: '\\(', right: '\\)', display: false}
          ],
          throwOnError: false
        });

        Alpine.start();
      });